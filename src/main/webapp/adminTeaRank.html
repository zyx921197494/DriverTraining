<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>管理员查询教练名单</title>
    <link rel="stylesheet" href="plugins/layui/css/layui.css" media="all"/>
    <link rel="stylesheet" href="css/global.css" media="all">
    <link rel="stylesheet" href="plugins/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="css/table.css"/>
</head>

<body onload="refresh()">

<script src="js2/jquery-3.3.1.min.js"></script>

<div class="admin-main">

    <fieldset class="layui-elem-field">
        <legend>教练名单</legend>

        <div class="layui-field-box layui-form" style="text-align: center">
            <table class="layui-table admin-table" style="text-align: center">
                <thead>
                <tr>
                    <!--<th style="width: 30px;"><input type="checkbox" lay-filter="allselector" lay-skin="primary"></th>-->
                    <th style="text-align: center">id</th>
                    <th style="text-align: center">姓名</th>
                    <th style="text-align: center">身份证</th>
                    <th style="text-align: center">邮箱</th>
                    <th style="text-align: center">等级</th>
                    <th style="text-align: center">修改等级</th>
                    <th style="text-align: center">提交</th>
                </tr>
                </thead>
                <tbody id="content">

                </tbody>
            </table>
        </div>
    </fieldset>

    <div class="admin-table-page">
        <div id="paged" class="page">
        </div>
    </div>
</div>

<script>
    $(function () {
        $.ajax({
            type: "POST",
            url: "/stu/available",
            dataType: "json",
            contentType: "application/json",
            success: function (result) {
                var data = result.data;
                for (var item of data) {
                    var card = item.card.toString().substr(0, 14);
                    $("#content").append(
                        `<tr id="${item.card}">
                        <td style="text-align: center">${item.id}</td>
                        <td style="text-align: center">${item.name}</td>
                        <td style="text-align: center">${card}xxxx</td>
                        <td style="text-align: center">${item.email}</td>
                        <td style="text-align: center">${item.rank}</td>
                        <td style="text-align: center">
                        <select style="text-align: center; margin:0; padding: 2%; width: auto; display: block" class="layui-form-select" id="${item.card}-rank">
                            <option style="text-align: center" value="1">等级 Ⅰ</option>
                            <option style="text-align: center" value="2">等级 Ⅱ</option>
                            <option style="text-align: center" value="3">等级 Ⅲ</option>
                        </select>
                        </td>
                        <td><button type="button" value="" class="layui-btn-normal layui-btn-radius" onclick="submit(this)">提交</button></td>
                        </tr>`
                    );
                }

            }
        })
    })


    function submit(obj) {
        var teaCard = $(obj).parent().parent().attr("id");
        var rank = document.getElementById(teaCard + "-rank").value;
        // alert("rank=" + rank + "teaCard=" + teaCard);
        $.ajax({
            type: "GET",
            url: "/admin/changeRank?card=" + teaCard + "&rank=" + rank,
            dataType: "json",
            contentType: "application/json",
            success: function (data) {
                if (data.status === "1") {
                    alert("修改成功");
                    $(location).attr('href', data.data);
                } else {
                    alert(data.msg);
                }
            }
        })
    }

    function refresh() {
        layui.use('table', function () {
            let form = layui.form(); //只有执行了这一步，部分表单元素才会自动修饰成功
            form.render();
        });
    }
</script>

</body>

</html>