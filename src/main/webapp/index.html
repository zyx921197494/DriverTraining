<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>登录</title>
    <link rel="stylesheet" href="css2/adminIndex.css">
</head>
<script src="js2/jquery-3.3.1.min.js"></script>
<script src="js2/login.js"></script>
<script src="js3/code.js"></script>
<body>

<div class="form">
    <h1>登录</h1>
    <div class="content">
<!--        <form action="/verify/login" method="post" id="login_form">-->
            <div class="txtb">
                <input type="text" id="card" autocomplete="off" placeholder="请输入身份证">
            </div>
            <div class="txtb">
                <input type="password" id="password" placeholder="请输入密码">
            </div>
            <div class="txtb">
                <input type="text" value="" placeholder="请输入验证码（不区分大小写）" class="input-val" />
            </div>
            <canvas id="canvas" width="100" height="43"></canvas>
<!--            <button class="btn">提交</button>-->
            <script>
                $(function() {
                    code_draw();
                    // 点击后刷新验证码
                    $("#canvas").on('click', function() {
                        code_draw();
                    })

                    $("#submit").on('click', function() {
                        // 将输入的内容转为大写，可通过这步进行大小写验证
                        var val = $(".input-val").val().toLowerCase();
                        // 获取生成验证码值
                        var num = $('#canvas').attr('data-code');
                        if (val === '') {
                            alert('请输入验证码！');
                        } else if (val === num) {
                            var card = $("#card").val().trim();
                            var password = $("#password").val().trim();
                            var sendData = JSON.stringify({'password':password,'card':card});
                            if (card.length === 0 || password.length === 0){
                                alert("您未输入 身份证或密码");
                                return false;
                            }else {
                                $.ajax({
                                    type:"POST",
                                    url:"/verify/login",
                                    data:sendData,
                                    dataType:"json",
                                    contentType:"application/json",
                                    success:function (data) {
                                        if(data.msg==="0"){
                                            alert("身份证或密码错误")
                                        }else{
                                            $(location).attr('href', data.msg);
                                        }
                                    }
                                })
                                // $("#login_form").submit();
                                // return true;
                            }
                            $(".input-val").val('');
                            draw(show_num);

                        } else {
                            alert('验证码错误！请重新输入！');
                            $(".input-val").val('');
                            draw(show_num);
                        }
                    })
                })
            </script>
            <a href="#" id="submit">登录</a>
            <div class="bottom-text">
                还没有账号？点此<a href="signUp.html">注册</a>
            </div>
<!--        </form>-->
    </div>
</div>

</body>
</html>
